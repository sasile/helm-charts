v3io:
  webApi: localhost:8081
  auth:
    username: iguazio
    password: iguazio
  functions:
    create: true
    items:
    - name: generate-data
      url: generate-data:8080
      handler: "functions.generate_data.generate_data:handler"
      runtime: "python:3.6"
      functionSourceCode: "aW1wb3J0IHJlcXVlc3RzDQppbXBvcnQgb3MNCmltcG9ydCBqc29uDQpmcm9tIGRlY2ltYWwgaW1wb3J0ICoNCmZyb20gcmFuZG9tIGltcG9ydCAqDQoNCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToNCg0KICAgICMgR2V0IHRoZSBJUCBhbmQgcG9ydCBvZiB0aGUgaW5nZXN0aW9uIGZ1bmN0aW9uIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzDQogICAgIyBkZWZpbmVkIHVzaW5nIE51Y2xpbw0KICAgIElOR0VTVF9VUkwgPSBvcy5nZXRlbnYgKCJJTkdFU1RfVVJMIikNCiAgICANCiAgICAjIExpc3Qgb2YgR1BTIGNvb3JkaW5hdGVzIGZvciByYW5kb21seSBzZWxlY3RlZCBsb2NhdGlvbnMNCiAgICAjIFRPRE86IE1vZGlmeSB0aGUgbGlzdCwgYXMgbmVlZGVkLCB0byB1c2UgeW91ciBwcmVmZXJyZWQgbG9jYXRpb25zLg0KICAgIERvd250b3duX0xvbmRvbiA9IFstMC4xMTk1LDUxLjUwMzNdDQogICAgV2VzdG1pbnN0ZXIgPSBbLTAuMTM1Nyw1MS40OTc1XQ0KICAgIE94Zm9yZF9TdCA9IFstMC4xNDEwLDUxLjUxNTRdDQogICAgSGVhdGhyb3cgPSBbLTAuNDU0Myw1MS40NzAwXQ0KICAgIEhlYXRocm93X1BhcmtpbmcgPSBbLTAuNDQ3Myw1MS40NTk5XQ0KICAgIEdhdHdpY2sgPSAgWzAuMTgyMSw1MS4xNTM3XQ0KICAgIENhbmFyeV9XaGFyZiA9IFstMC4wMjM1LDUxLjUwNTRdDQogICAgTG9jYXRpb25zID0gW0NhbmFyeV9XaGFyZixDYW5hcnlfV2hhcmYsRG93bnRvd25fTG9uZG9uLFdlc3RtaW5zdGVyLE94Zm9yZF9TdCxPeGZvcmRfU3QsT3hmb3JkX1N0LEhlYXRocm93LEhlYXRocm93X1BhcmtpbmcsR2F0d2lja10NCg0KICAgICMgR2V0IElQIGFuZCBQb3J0IG9mIHRoZSBpbmdlc3Rpb24gZnVuY3Rpb24gZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZGVmaW5lZCB1c2luZyBOdWNsaW8NCiAgICBJTkdFU1RfVVJMID0gb3MuZ2V0ZW52ICgiSU5HRVNUX1VSTCIpDQoNCiAgICAjIENyZWF0ZSBhIHNlc3Npb24gZm9yIHNlbmRpbmcgcmVxdWVzdHMgZm9yIGluZ2VzdGlvbg0KICAgIHMgPSByZXF1ZXN0cy5TZXNzaW9uKCkNCiAgICByZXF1ZXN0X2pzb24gPSB7fQ0KDQogICAgIyBHZW5lcmF0ZSByYW5kb20gZHJpdmVyIGxvY2F0aW9ucyBmb3IgMTAwMCBkcml2ZXJzIGFuZCBzZW5kIHRoZSBkYXRhIGZvcg0KICAgICMgaW5nZXN0aW9uDQogICAgZm9yIHggaW4gcmFuZ2UgKDEsMTAwMCk6DQogICAgICAgIHJuZF9kcml2ZXIgPSByYW5kaW50ICgxLDUwMDApDQogICAgICAgIHJuZF9sb2NhdGlvbiA9IHJhbmRpbnQgKDAsOSkNCiAgICAgICAgcm5kX3JhZGl1cyA9cmFuZGludCAoMCw4KQ0KICAgICAgICBybmRfbG9uZyA9IHJhbmRpbnQgKC1ybmRfcmFkaXVzLHJuZF9yYWRpdXMpDQogICAgICAgIHJuZF9sYXQgID0gcmFuZGludCAoLXJuZF9yYWRpdXMscm5kX3JhZGl1cykNCiAgICAgICAgbG9uZ2l0dWRlID0gIERlY2ltYWwgKExvY2F0aW9uc1tybmRfbG9jYXRpb25dWzBdKSArIChEZWNpbWFsIChybmRfbG9uZykgLyBEZWNpbWFsICgzMDApKQ0KICAgICAgICBsYXRpdHVkZSA9IERlY2ltYWwgKExvY2F0aW9uc1tybmRfbG9jYXRpb25dWzFdKSAgKyAoRGVjaW1hbCAocm5kX2xhdCkgLyBEZWNpbWFsICgzMDApKQ0KICAgICAgICANCiAgICAgICAgI2NvbnRleHQubG9nZ2VyLmluZm8oJ2RyaXZlciBpZCAtICcrIHN0cihybmRfZHJpdmVyKSkNCg0KICAgICAgICAjIEJ1aWxkIGEgSlNPTiByZXF1ZXN0IGJvZHkNCiAgICAgICAgcmVxdWVzdF9qc29uWyJSZWNvcmRUeXBlIl0gPSAiZHJpdmVyIg0KICAgICAgICByZXF1ZXN0X2pzb25bIklEIl0gPSBybmRfZHJpdmVyDQogICAgICAgIHJlcXVlc3RfanNvblsibG9uZ2l0dWRlIl0gPSBzdHIgKGxvbmdpdHVkZSkNCiAgICAgICAgcmVxdWVzdF9qc29uWyJsYXRpdHVkZSJdID0gc3RyIChsYXRpdHVkZSkNCiAgICAgICAgDQogICAgICAgIHBheWxvYWQgPSBqc29uLmR1bXBzKHJlcXVlc3RfanNvbikNCg0KICAgICAgICAjIFNlbmQgYSByZXF1ZXN0IHRvIHRoZSBpbmdlc3Rpb24gZnVuY3Rpb24NCiAgICAgICAgcmVzID0gcy5wdXQoSU5HRVNUX1VSTCwgZGF0YT1wYXlsb2FkKQ0KICAgICAgICBpZiByZXMuc3RhdHVzX2NvZGUgIT0gcmVxdWVzdHMuY29kZXMub2s6DQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcigiSW5nZXN0aW9uIG9mIGRyaXZlcnMgZmFpbGVkIHdpdGggZXJyb3IgY29kZSA6IitzdHIocmVzLnN0YXR1c19jb2RlKSkNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9J0luZ2VzdGlvbiBvZiBkcml2ZXIgZmFpbGVkJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU9NTAwKQ0KICAgICAgICANCg0KICAgIyBHZW5lcmF0ZSByYW5kb20gbG9jYXRpb24gZm9yIDEsNTAwIHBhc3NlbmdlcnMgYW5kIHNlbmQgZm9yIGluZ2VzdGlvbg0KICAgIGZvciB4IGluIHJhbmdlICgxLDUwMCk6DQogICAgICAgIHJuZF9kcml2ZXIgPSByYW5kaW50ICgxLDUwMDApDQogICAgICAgIHJuZF9sb2NhdGlvbiA9IHJhbmRpbnQgKDAsOSkNCiAgICAgICAgcm5kX3JhZGl1cyA9cmFuZGludCAoMCw4KQ0KICAgICAgICBybmRfbG9uZyA9IHJhbmRpbnQgKC1ybmRfcmFkaXVzLHJuZF9yYWRpdXMpDQogICAgICAgIHJuZF9sYXQgID0gcmFuZGludCAoLXJuZF9yYWRpdXMscm5kX3JhZGl1cykNCiAgICAgICAgbG9uZ2l0dWRlID0gIERlY2ltYWwgKExvY2F0aW9uc1tybmRfbG9jYXRpb25dWzBdKSArIChEZWNpbWFsIChybmRfbG9uZykgLyBEZWNpbWFsICgzMDApKQ0KICAgICAgICBsYXRpdHVkZSA9IERlY2ltYWwgKExvY2F0aW9uc1tybmRfbG9jYXRpb25dWzFdKSAgKyAoRGVjaW1hbCAocm5kX2xhdCkgLyBEZWNpbWFsICgzMDApKQ0KICAgICAgICANCiAgICAgICAgI2NvbnRleHQubG9nZ2VyLmluZm8oJ3Bhc3NlbmdlciBpZCAtICcrIHN0cihybmRfZHJpdmVyKSkNCg0KICAgICAgICAjIEJ1aWxkIGEgSlNPTiByZXF1ZXN0IGJvZHkNCiAgICAgICAgcmVxdWVzdF9qc29uWyJSZWNvcmRUeXBlIl0gPSAicGFzc2VuZ2VyIg0KICAgICAgICByZXF1ZXN0X2pzb25bIklEIl0gPSBybmRfZHJpdmVyDQogICAgICAgIHJlcXVlc3RfanNvblsibG9uZ2l0dWRlIl0gPSBzdHIgKGxvbmdpdHVkZSkNCiAgICAgICAgcmVxdWVzdF9qc29uWyJsYXRpdHVkZSJdID0gc3RyIChsYXRpdHVkZSkNCiAgICAgICAgDQogICAgICAgIHBheWxvYWQgPSBqc29uLmR1bXBzKHJlcXVlc3RfanNvbikNCg0KICAgICAgICAjIFNlbmQgYSByZXF1ZXN0IHRvIHRoZSBpbmdlc3Rpb24gZnVuY3Rpb24NCiAgICAgICAgcmVzID0gcy5wdXQoSU5HRVNUX1VSTCwgZGF0YT1wYXlsb2FkKQ0KICAgICAgICANCiAgICAgICAgaWYgcmVzLnN0YXR1c19jb2RlICE9IHJlcXVlc3RzLmNvZGVzLm9rOg0KICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuZXJyb3IoIkluZ2VzdGlvbiBvZiBwYXNzZW5nZXJzIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgOiIrc3RyKHJlcy5zdGF0dXNfY29kZSkpDQogICAgICAgICAgICByZXR1cm4gY29udGV4dC5SZXNwb25zZShib2R5PSdJbmdlc3Rpb24gb2YgcGFzc2VuZ2VycyBmYWlsZWQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9e30sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudF90eXBlPSd0ZXh0L3BsYWluJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfY29kZT01MDApDQoNCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdFbmQgLSBHZW5lcmF0aW5nIERhdGEnKQ0KDQogICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nSW5nZXN0aW9uIG9mIGRyaXZlcnMgYW5kIHBhc3NlbmdlcnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17fSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X3R5cGU9J3RleHQvcGxhaW4nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlPTIwMCkNCg0K" 
      env:
        - name: INGEST_URL
          value: "http://ingest:8080"
      image:
        repository: iguaziodocker/cloud_demo_functions
        tag: "0.0.1"
    - name: ingest
      url: ingest:8080
      handler: "functions.ingest.ingest:handler"
      runtime: "python:3.6"
      functionSourceCode: "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgczJzcGhlcmUKCiMgR2V0IGNvbmZpZ3VyYXRpb24gaW5mb3JtYXRpb24gZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZGVmaW5lZCB1c2luZyBOdWNsaW8KIyBXZWItQVBJcyAod2ViLWdhdGV3YXkpIFVSTApXRUJBUElfVVJMICAgICA9IHN0cihvcy5nZXRlbnYoJ1dFQkFQSV9VUkwnKSkKIyBDb250YWluZXIgbmFtZQpDT05UQUlORVJfTkFNRSA9IHN0cihvcy5nZXRlbnYoJ0NPTlRBSU5FUl9OQU1FJykpCiMgV2ViLUFQSXMgdXNlciBjcmVkZW50aWFscyAodXNlZCBmb3IgSFRUUCBhdXRoZW50aWNhdGlvbikKV0VCQVBJX1VTRVIgPSBvcy5nZXRlbnYoJ1dFQkFQSV9VU0VSJykKV0VCQVBJX1BBU1NXT1JEID0gb3MuZ2V0ZW52KCdXRUJBUElfUEFTU1dPUkQnKQpXRUJBUElfQ1JFRCA9IG9zLmdldGVudignV0VCQVBJX0NSRUQnKQojIFRhYmxlIHBhdGhzCkRSSVZFUlNfVEFCTEVfUEFUSCA9IENPTlRBSU5FUl9OQU1FICsgc3RyKG9zLmdldGVudignRFJJVkVSU19UQUJMRScpKQpQQVNTRU5HRVJTX1RBQkxFX1BBVEggPSBDT05UQUlORVJfTkFNRSArIHN0cihvcy5nZXRlbnYoJ1BBU1NFTkdFUlNfVEFCTEUnKSkKQ0VMTFNfVEFCTEVfUEFUSCAgID0gQ09OVEFJTkVSX05BTUUgKyBzdHIob3MuZ2V0ZW52KCdDRUxMU19UQUJMRScpKQoKRFJJVkVSX1BSRUZJWCA9ICdkcml2ZXJzXycKUEFTU0VOR0VSX1BSRUZJWCA9ICdwYXNzZW5nZXJzXycKClYzSU9fSEVBREVSX0ZVTkNUSU9OID0gJ1gtdjNpby1mdW5jdGlvbicKCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToKCiAgICAjIFJlYWQgdGhlIGRhdGEgdG8gYmUgaW5nZXN0ZWQgZnJvbSB0aGUgaW5wdXQgSlNPTiByZXF1ZXN0IGJvZHkKICAgIGlucHV0X2RhdGFfanNvbiA9IGV2ZW50LmJvZHkgCiAgICBpbnB1dF9kYXRhID0ganNvbi5sb2FkcyhpbnB1dF9kYXRhX2pzb24pCgogICAgcmVjb3JkX3R5cGUgPSBzdHIoaW5wdXRfZGF0YSBbIlJlY29yZFR5cGUiXSkKCiAgICBpZCA9IHN0cihpbnB1dF9kYXRhIFsiSUQiXSkKICAgIAogICAgbG9uZ2l0dWRlID0gZmxvYXQgKGlucHV0X2RhdGFbImxvbmdpdHVkZSJdKQogICAgbGF0aXR1ZGUgPSBmbG9hdCAoaW5wdXRfZGF0YVsibGF0aXR1ZGUiXSkKCiAgICAjIFVzZSB0aGUgR29vZ2xlIHMyc3BoZXJlIGxpYnJhcnkgdG8gY2FsY3VsYXRlIGEgY2VsbCBmcm9tIHRoZSBsb25naXR1ZGUKICAgICMgYW5kIGxhdGl0dWRlIGRlZ3JlZXMKICAgIHAxID0gczJzcGhlcmUuTGF0TG5nLmZyb21fZGVncmVlcyhsYXRpdHVkZSxsb25naXR1ZGUpCiAgICBjZWxsID0gczJzcGhlcmUuQ2VsbElkLmZyb21fbGF0X2xuZyhwMSkucGFyZW50KDE1KQogICAgY2VsbF9pZCA9IHN0cihjZWxsLmlkKCkpCiAgICAKICAgICMgQ3JlYXRlIGEgc2Vzc2lvbiBmb3Igc2VuZGluZyBOb1NRTCBXZWIgQVBJIHJlcXVlc3RzCiAgICBzID0gcmVxdWVzdHMuU2Vzc2lvbigpCgogICAgIyBQcm92aWRlIHdlYmFwaSB1c2VyL3Bhc3MKICAgIGlmIFdFQkFQSV9VU0VSIGlzIG5vdCBOb25lOgogICAgICAgIHMuYXV0aCA9IChzdHIoV0VCQVBJX1VTRVIpLCBzdHIoV0VCQVBJX1BBU1NXT1JEKSkKICAgIAogICAgIyBJbmdlc3Rpb24gb2YgYm90aCBkcml2ZXJzIGFuZCBwYXNzZW5nZXJzIGFyZSBzdXBwb3J0ZWQKICAgICMgRGVwZW5kaW5nIG9uIHJlY29yZCB0eXBlLCByZWxldmFudCB0YWJsZXMgd2lsbCBiZSB1cGRhdGVkCiAgICBpZiByZWNvcmRfdHlwZSA9PSAnZHJpdmVyJzoKICAgICAgICBJVEVNX1BSRUZJWCA9IERSSVZFUl9QUkVGSVgKICAgICAgICBJVEVNX1BBVEggICA9IERSSVZFUlNfVEFCTEVfUEFUSAogICAgZWxzZSA6CiAgICAgICAgSVRFTV9QUkVGSVggPSBQQVNTRU5HRVJfUFJFRklYCiAgICAgICAgSVRFTV9QQVRIID0gUEFTU0VOR0VSU19UQUJMRV9QQVRICgogICAgIyBVcGRhdGUgdGhlIGRyaXZlcidzIGN1cnJlbnQgYW5kIHByZXZpb3VzIGxvY2F0aW9uIAogICAgcmVzID0gbmd4X3VwZGF0ZV9leHByZXNzaW9uX3JlcXVlc3QocyxXRUJBUElfVVJMLCBJVEVNX1BBVEggKyBJVEVNX1BSRUZJWCAraWQsIE5vbmUsIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU0VUIHByZXZpb3VzX2NlbGxfaWQ9aWZfbm90X2V4aXN0cyhjdXJyZW50X2NlbGxfaWQsMCk7Y3VycmVudF9jZWxsX2lkPSIgKyBjZWxsX2lkICsgIjtjaGFuZ2VfY2VsbF9pZF9pbmRpY2F0b3I9KHByZXZpb3VzX2NlbGxfaWQgIT0gY3VycmVudF9jZWxsX2lkKTsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vbmUpCgogICAgaWYgcmVzLnN0YXR1c19jb2RlIG5vdCBpbiAoMjAwLDIwNCk6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yICgiRXJyb3IgZHVyaW5nIHVwZGF0ZSBvZiBkcml2ZXJzIHRhYmxlLiBFcnJvciBjb2RlIGlzICIrc3RyKHJlcy5zdGF0dXNfY29kZSkpCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9J0ludGVybmFsIGVycm9yIGR1cmluZyBpbmdlc3Rpb24nLGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsc3RhdHVzX2NvZGU9NTAwKQogICAgCiAgICAjIEdldCB0aGUgZHJpdmVyJ3MgY3VycmVudCBhbmQgcHJldmlvdXMgY2VsbAogICAgcmVzcG9uc2VfanNvbiA9IG5neF9nZXRfaXRlbV9yZXF1ZXN0KHMsV0VCQVBJX1VSTCwgSVRFTV9QQVRIICsgSVRFTV9QUkVGSVggK2lkLE5vbmUsTm9uZSxleHBfYXR0cnM9WyJjaGFuZ2VfY2VsbF9pZF9pbmRpY2F0b3IiLCJjdXJyZW50X2NlbGxfaWQiLCJwcmV2aW91c19jZWxsX2lkIl0pCgogICAgIyBDaGVjayB3aGV0aGVyIGEgY2VsbC11cGRhdGUgaXMgbmVlZGVkCiAgICBhdHRycyA9IHJlc3BvbnNlX2pzb25bIkl0ZW0iXQogICAgY2hhbmdlX2NlbGxfaWRfaW5kaWNhdG9yX3ZhbCA9IGF0dHJzWyJjaGFuZ2VfY2VsbF9pZF9pbmRpY2F0b3IiXVsiQk9PTCJdCiAgICBjdXJyZW50X2NlbGxfaWRfdmFsID0gYXR0cnNbImN1cnJlbnRfY2VsbF9pZCJdWyJOIl0KICAgIHByZXZpb3VzX2NlbGxfaWRfdmFsID0gYXR0cnNbInByZXZpb3VzX2NlbGxfaWQiXVsiTiJdCgogICAgIyBJZiB0aGUgZHJpdmVyJ3MgY2VsbCBoYXMgY2hhbmdlZCwgaW5jcmVhc2UgdGhlIGRyaXZlcnMgY291bnQgZm9yIHRoZSBuZXcKICAgICMgY2VsbCBhbmQgZGVjcmVhc2UgdGhlIGNvdW50IGZvciB0aGUgb2xkIGNlbGwKICAgIGlmIGNoYW5nZV9jZWxsX2lkX2luZGljYXRvcl92YWw6CiAgICAgICAgICAgICMgSW5jcmVhc2UgdGhlIGNvdW50IGZvciB0aGUgZHJpdmVyJ3MgbmV3IChjdXJyZW50KSBjZWxsCiAgICAgICAgICAgIHJlcz1uZ3hfdXBkYXRlX2V4cHJlc3Npb25fcmVxdWVzdChzLFdFQkFQSV9VUkwsIENFTExTX1RBQkxFX1BBVEggKyAiY2VsbF8iKyBjdXJyZW50X2NlbGxfaWRfdmFsLCBOb25lLCBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU0VUICIrSVRFTV9QUkVGSVgrImNvdW50PWlmX25vdF9leGlzdHMoIitJVEVNX1BSRUZJWCsiY291bnQsMCkrMTsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb25lKQoKICAgICAgICAgICAgaWYgcmVzLnN0YXR1c19jb2RlIG5vdCBpbiAoMjAwLDIwNCk6CiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvciAoIkVycm9yIGR1cmluZyBpbmNyZW1lbnQgb2YgY291bnQgaW4gY2VsbHMgdGFibGUuIEVycm9yIGNvZGUgaXMgIitzdHIocmVzLnN0YXR1c19jb2RlKSkKICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9J0ludGVybmFsIGVycm9yIGR1cmluZyBpbmdlc3Rpb24nLGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsc3RhdHVzX2NvZGU9NTAwKQoKCiAgICAgICAgICAgICMgRGVjcmVhc2UgdGhlIGNvdW50IGZvciB0aGUgZHJpdmVyJ3MgcHJldmlvdXMgY2VsbAogICAgICAgICAgICByZXMgPSBuZ3hfdXBkYXRlX2V4cHJlc3Npb25fcmVxdWVzdChzLFdFQkFQSV9VUkwsIENFTExTX1RBQkxFX1BBVEggKyAiY2VsbF8iICsgcHJldmlvdXNfY2VsbF9pZF92YWwsIE5vbmUsIE5vbmUsTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlNFVCAiK0lURU1fUFJFRklYKyJjb3VudD0iK0lURU1fUFJFRklYKyJjb3VudC0xOyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vbmUpCgogICAgICAgICAgICAjIGlmIHJlcy5zdGF0dXNfY29kZSBub3QgaW4gKDIwMCwyMDQpOgogICAgICAgICAgICAjICAgICBjb250ZXh0LmxvZ2dlci5lcnJvciAoIkVycm9yIGR1cmluZyBkZWNyZW1lbnQgb2YgY291bnQgaW4gY2VsbHMgdGFibGUuIEVycm9yIGNvZGUgaXMgIitzdHIocmVzLnN0YXR1c19jb2RlKSkKICAgICAgICAgICAgIyAgICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nSW50ZXJuYWwgZXJyb3IgZHVyaW5nIGluZ2VzdGlvbicsY29udGVudF90eXBlPSd0ZXh0L3BsYWluJyxzdGF0dXNfY29kZT01MDApCgogICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nSW5nZXN0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfY29kZT0yMDApCgojCiMgQ29uc3RydWN0IGFuZCBzZW5kIGEgR2V0SXRlbSBOb1NRTCBXZWIgQVBJIHJlcXVlc3QKIwpkZWYgbmd4X2dldF9pdGVtX3JlcXVlc3QoCiAgICAgICAgcyxiYXNlX3VybCwgcGF0aF9pbl91cmwsIHRhYmxlX25hbWU9Tm9uZSwga2V5PU5vbmUsIGV4cF9hdHRycz1Ob25lLCBleHBlY3RlZF9yZXN1bHQ9cmVxdWVzdHMuY29kZXMub2spOgogICAgdXJsID0gb3MucGF0aC5qb2luKGJhc2VfdXJsLCBwYXRoX2luX3VybCkKCiAgICAjIEJ1aWxkIGEgSlNPTiByZXF1ZXN0IGJvZHkKICAgIHJlcXVlc3RfanNvbiA9IHt9CgogICAgaWYgdGFibGVfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICByZXF1ZXN0X2pzb25bIlRhYmxlTmFtZSJdID0gdGFibGVfbmFtZQoKICAgIHJlcXVlc3RfanNvblsiQXR0cmlidXRlc1RvR2V0Il0gPSAiIgoKICAgIGZvciBhdHRyX25hbWUgaW4gZXhwX2F0dHJzOgogICAgICAgIGlmIHJlcXVlc3RfanNvblsiQXR0cmlidXRlc1RvR2V0Il0gIT0gIiI6CiAgICAgICAgICAgIHJlcXVlc3RfanNvblsiQXR0cmlidXRlc1RvR2V0Il0gKz0gIiwiCiAgICAgICAgcmVxdWVzdF9qc29uWyJBdHRyaWJ1dGVzVG9HZXQiXSArPSBhdHRyX25hbWUKCiAgICBwYXlsb2FkID0ganNvbi5kdW1wcyhyZXF1ZXN0X2pzb24pCiAgICAKICAgIGlmIFdFQkFQSV9DUkVEIGlzIE5vbmU6CiAgICAgICAgaGVhZGVycyA9IHtWM0lPX0hFQURFUl9GVU5DVElPTjogJ0dldEl0ZW0nfQogICAgZWxzZToKICAgICAgICBoZWFkZXJzID0ge1YzSU9fSEVBREVSX0ZVTkNUSU9OOiAnR2V0SXRlbScsIkF1dGhvcml6YXRpb24iOiBzdHIoV0VCQVBJX0NSRUQpfQogICAgCiAgICAjIFNlbmQgdGhlIHJlcXVlc3QKICAgIHJlcyA9IHMucHV0KHVybCwgZGF0YT1wYXlsb2FkLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgYXNzZXJ0IHJlcy5zdGF0dXNfY29kZSA9PSBleHBlY3RlZF9yZXN1bHQKICAgIGlmIGV4cGVjdGVkX3Jlc3VsdCAhPSByZXF1ZXN0cy5jb2Rlcy5vazoKICAgICAgICByZXR1cm4KCiAgICByZXNwb25zZV9qc29uID0ganNvbi5sb2FkcyhyZXMuY29udGVudCkKICAgIHJldHVybiByZXNwb25zZV9qc29uCgojCiMgQ29uc3RydWN0IGFuZCBzZW5kIGFuIFVwZGF0ZUl0ZW0gTm9TUUwgV2ViIEFQSSByZXF1ZXN0CiMKZGVmIG5neF91cGRhdGVfZXhwcmVzc2lvbl9yZXF1ZXN0KAogICAgICAgIHMsYmFzZV91cmwsIHBhdGhfaW5fdXJsLCB0YWJsZV9uYW1lPU5vbmUsIGtleT1Ob25lLCBtb2RlPU5vbmUsIHVwZGF0ZV9leHByPU5vbmUsIHRleHRfZmlsdGVyPU5vbmUsIHR5cGU9IlVwZGF0ZUl0ZW0iLAogICAgICAgIGV4cGVjdGVkX3Jlc3VsdD1yZXF1ZXN0cy5jb2Rlcy5ub19jb250ZW50KToKICAgIHVybCA9IG9zLnBhdGguam9pbihiYXNlX3VybCwgcGF0aF9pbl91cmwpCgogICAgIyBCdWlsZCBhIEpTT04gcmVxdWVzdCBib2R5CiAgICByZXF1ZXN0X2pzb24gPSB7fQoKICAgIGlmIHRhYmxlX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgcmVxdWVzdF9qc29uWyJUYWJsZU5hbWUiXSA9IHRhYmxlX25hbWUKCiAgICBpZiBtb2RlIGlzIG5vdCBOb25lOgogICAgICAgIHJlcXVlc3RfanNvblsiVXBkYXRlTW9kZSJdID0gbW9kZQoKICAgIGlmIHVwZGF0ZV9leHByIGlzIG5vdCBOb25lOgogICAgICAgIHJlcXVlc3RfanNvblsiVXBkYXRlRXhwcmVzc2lvbiJdID0gdXBkYXRlX2V4cHIKCiAgICBpZiB0ZXh0X2ZpbHRlciBpcyBub3QgTm9uZToKICAgICAgICByZXF1ZXN0X2pzb25bIkNvbmRpdGlvbkV4cHJlc3Npb24iXSA9IHRleHRfZmlsdGVyCgogICAgcGF5bG9hZCA9IGpzb24uZHVtcHMocmVxdWVzdF9qc29uKQogICAgCiAgICBpZiBXRUJBUElfQ1JFRCBpcyBOb25lOgogICAgICAgaGVhZGVycyA9IHtWM0lPX0hFQURFUl9GVU5DVElPTjogdHlwZSB9CiAgICBlbHNlOgogICAgICAgaGVhZGVycyA9IHtWM0lPX0hFQURFUl9GVU5DVElPTjogdHlwZSAsIkF1dGhvcml6YXRpb24iOiBzdHIoV0VCQVBJX0NSRUQpfQoKICAgICMgU2VuZCB0aGUgcmVxdWVzdAogICAgcmVzID0gcy5wdXQodXJsLCBkYXRhPXBheWxvYWQsIGhlYWRlcnM9aGVhZGVycykKICAgICNhc3NlcnQgcmVzLnN0YXR1c19jb2RlID09IGV4cGVjdGVkX3Jlc3VsdAogICAgcmV0dXJuIHJlcwo="
      env:
        - name: CONTAINER_NAME
          value: bigdata
        - name: DRIVERS_TABLE
          value: /taxi_example/drivers/
        - name: PASSENGERS_TABLE
          value: /taxi_example/passengers/
        - name: CELLS_TABLE
          value: /taxi_example/cells/
      image:
        repository: iguaziodocker/cloud_demo_functions
        tag: "0.0.1"

image:
  repository: "iguaziodocker/cloud_demo"
  tag: "v6"
  pullPolicy: "IfNotPresent"

demo:
  root: /visualization
  container: bigdata
  collection: taxi_example/cells
  refresh: 2000
  center:
    lat: 0
    lng: 0
    zoom: 8
  shift:
    lat: 0
    lng: 0
  heatMap:
    r: 10
    blur: 15
    max: 5.0

service:
  nodePort: 30555
